import{d as g}from"./player.DQDFRdEJ.js";import{$ as l}from"./store.DE-WIDqh.js";const I=n=>{n.classList.add("hidden"),n.classList.remove("flex")},v=n=>{n.classList.add("flex"),n.classList.remove("hidden")},N="!bg-blue-hover",S=document.querySelectorAll(".playAnnotation");for(let n=0;n<S.length;n++){const o=S[n];if(o.dataset.start&&o.dataset.playerId){const s=l.get()[o.dataset.playerId]?.annotationStarts;s&&(s.push({start:Math.floor(Number(o.dataset.start)),end:Math.floor(Number(o.dataset.end))>Math.floor(Number(o.dataset.start))?Math.floor(Number(o.dataset.end)):void 0,playerId:o.dataset.playerId}),l.setKey(o.dataset.playerId,{...l.get()[o.dataset.playerId]||g,annotationStarts:s})),o.addEventListener("click",()=>{const r=o.dataset.playerId||"null",e=o.dataset.file;l.setKey(r,{...l.get()[r]||g,position:Number(o.dataset.start),seekTo:Number(o.dataset.start),isPlaying:e})})}}l.listen((n,o,s)=>{if(!s)return null;const r=s.split(".")[0],e=n[r],d=document.querySelector(`.eventContainer[data-player-id="${r}"]`);if(!d)return console.error(`No event container found for ${s}`),null;const c=d.querySelectorAll(".annotationNode"),f=d.querySelectorAll(".annotationTags"),p=e.annotationStarts?.filter(t=>t.playerId===s),u=p?.findIndex((t,a)=>typeof t.end=="number"?t.start<=e.position&&t.end>e.position:a<p.length-1?t.start<=e.position&&p[a+1].start>e.position:t.start<=e.position);if(typeof u=="number"&&u>=0){const t=c[u];if(t){if(e.autoScroll)if(e.isEmbed){const a=document.querySelector(`.videoAnnotationContainer[data-player-id="${s}"]`),i=t.offsetTop;a?a.scroll({top:i-a.clientHeight,behavior:"smooth"}):d.scroll({top:i-d.clientHeight/3,behavior:"smooth"})}else t.scrollIntoView({behavior:"smooth",block:"end"});t.classList.add(N)}for(let a=0;a<c.length;a++)a!==u&&c[a].classList.remove(N)}if(e.showTags!==o[r]?.showTags)if(e.showTags)for(let t=0;t<f.length;t++)v(f[t]);else for(let t=0;t<f.length;t++)I(f[t]);for(const t of c){const a=t.getAttribute("data-uuid");let i="show";if((!a||!e.filteredAnnotations.includes(a))&&(i="hide"),e.clip){const h=t.getAttribute("data-start"),y=t.getAttribute("data-end");if(h&&y){const m=parseInt(h),b=parseInt(y),A=m>e.clip.start&&m<e.clip.end,T=b>e.clip.start&&b<e.clip.end;(!A||!T)&&(i="hide")}}i==="show"?v(t):I(t)}});
